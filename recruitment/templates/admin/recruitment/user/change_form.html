{% extends "admin/change_form.html" %}
{% load i18n admin_urls %}

{% block content %}
  {% if profile %}
    <div style="border:1px solid #d1d5db;background:#f8fafc;border-radius:12px;padding:12px 14px;margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <div style="font-weight:600">Applicant Overview</div>
          <div style="font-size:13px;color:#475569">
            Applicant: <strong>{{ profile.full_name }}</strong>
            {% if profile_url %}
              • <a href="{{ profile_url }}" class="button" style="padding:2px 8px;border-radius:8px">Open Full Application View ↗</a>
            {% endif %}
            {% if current_app %}
              <br>
              Cycle: <strong>{{ current_app.cycle }}</strong> •
              Status: <strong>{{ current_app.get_status_display }}</strong> •
              Total Score: <strong>{{ current_app.total_score }}</strong> •
              {% if current_elig %}
                Eligibility: <strong>{{ current_elig.get_result_display }}</strong>
                <span style="font-size:12px;color:#64748b">
                  (Age: {{ current_elig.age_ok|yesno:"OK,Fail" }},
                   Edu: {{ current_elig.education_ok|yesno:"OK,Fail" }},
                   Med: {{ current_elig.medical_ok|yesno:"OK,Fail" }},
                   Police: {{ current_elig.police_ok|yesno:"OK,Fail" }})
                </span>
              {% else %}
                Eligibility: <em>not yet computed</em>
              {% endif %}
            {% else %}
              <br><em>No application found.</em>
            {% endif %}
          </div>
        </div>

        {% if current_app %}
        <div style="display:flex;gap:8px">
          <form method="post" action="{% url 'rpngc_admin:recruitment_applicantprofile_application_action' profile.pk 'shortlist' %}">
            {% csrf_token %}
            <button type="submit" class="button default">Shortlist</button>
          </form>
          <form method="post" action="{% url 'rpngc_admin:recruitment_applicantprofile_application_action' profile.pk 'approve' %}">
            {% csrf_token %}
            <button type="submit" class="button button-primary">Approve</button>
          </form>
          <form method="post" action="{% url 'rpngc_admin:recruitment_applicantprofile_application_action' profile.pk 'reject' %}">
            {% csrf_token %}
            <button type="submit" class="button deletelink">Reject</button>
          </form>
        </div>
        {% endif %}
      </div>

      <div style="margin-top:10px">
        <details>
          <summary style="cursor:pointer;color:#0f3b6d"><strong>Documents</strong> (click to expand)</summary>
          <div style="overflow:auto;margin-top:8px">
            <table class="listing" style="min-width:560px">
              <thead>
                <tr><th>Type</th><th>File</th><th>Status</th></tr>
              </thead>
              <tbody>
                {% if current_app_docs %}
                  {{ current_app_docs|safe }}
                {% else %}
                  <tr><td colspan="3"><em>No documents uploaded.</em></td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </details>
      </div>
    </div>
  {% else %}
    <div style="border:1px solid #fecaca;background:#fff1f2;color:#7f1d1d;border-radius:12px;padding:10px 12px;margin-bottom:12px">
      This user has no Applicant Profile yet.
    </div>
  {% endif %}

  {{ block.super }}
{% endblock %}
